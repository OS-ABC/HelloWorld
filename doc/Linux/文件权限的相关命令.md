代码在 4.15.0-30deepin-generic 中调试，在WSL（Windows Subsystem for Linux）中，存在部分问题。

### 1. 先来解释一下DAC
**DAC（Discretionary Access Control，自主访问控制）**
1. DAC是传统的Linux的访问控制方式，DAC可以对文件、文件夹、共享资源等进行访问控制。
2. 在DAC这种模型中，文件客体的所有者（或者管理员）负责管理访问控制。
3. DAC使用了*ACL（Access Control List，访问控制列表）* 来给单一用户提供不同的权限，而root用户对文件系统有完全自由的控制权。

### 2. setfacl和getfacl命令

**ACL**，即*Access Control List*。 主要的目的是提供传统的owner,group,others的read,write,execute权限之外的具体权限设置，ACL可以针对单一用户、单一文件或目录来进行r,w,x的权限控制，对于需要特殊权限的使用状况有一定帮助。如，某一个文件，不让单一的某个用户访问。[ACL存在的意义](http://c.biancheng.net/view/863.html)


    2.1. ACL使用两个命令来对其进行控制
- **getfacl**(get file access control lists)：展示文件名，所有者，组名，还有访问控制列表。
- **setfacl**(set file access control lists)：可以设置文件或者目录的访问权限。


setfacl 参数：
```
  -m：设置后续acl参数 

  -x：删除后续acl参数  

  -b：删除全部的acl参数

  -k：删除默认的acl参数

  -R：递归设置acl，包括子目录

  -d：设置默认acl
```

    2.2. 例子：
- 创建文件test，将其权限修改为777，并查看其默认ACL权限配置
```
lcy@lcy-PC:~$ touch test.txt                        //创建文件
lcy@lcy-PC:~$ ls -lh test.txt                       //查看文件权限
-rw-r--r-- 1 lcy lcy 0 11月  4 10:05 test.txt
lcy@lcy-PC:~$ getfacl test.txt                      //查看文件的访问控制权限
# file: test.txt
# owner: lcy
# group: lcy
user::rw-
group::r--
other::r--

lcy@lcy-PC:~$ getfacl --omit-header test.txt        //输出精简信息
user::rw-
group::r--
other::r--

lcy@lcy-PC:~$ chmod 777 test.txt                    //改变文件权限
lcy@lcy-PC:~$ ls -lh test.txt
-rwxrwxrwx 1 lcy lcy 0 11月  4 10:05 test.txt
lcy@lcy-PC:~$ getfacl test.txt
# file: test.txt
# owner: lcy
# group: lcy
user::rwx
group::rwx
other::rwx
```

- 修改ACL策略，使得用户sam只有读取的权限

```
lcy@lcy-PC:~$ cat >test.txt                         //写文件
hello, lcy
lcy@lcy-PC:~$ cat test.txt                          //查看文件
hello, lcy
lcy@lcy-PC:~$ getfacl --omit-header test.txt
user::rwx
group::rwx
other::rwx

lcy@lcy-PC:~$ setfacl -m u:sam:r test.txt           //设置 sam 对文件test只有读权限
lcy@lcy-PC:~$ ls -lh test.txt
-rwxrwxrwx+ 1 lcy lcy 11 11月  4 10:11 test.txt     //权限的最后多了一个符号 '+'
lcy@lcy-PC:~$ getfacl --omit-header test.txt
user::rwx
user:sam:r--                                        //这里明确了sam 的单独权限
group::rwx
mask::rwx
other::rwx

lcy@lcy-PC:~$ su sam                                //切换到sam账号
密码：
$ ls
Desktop  Documents  Downloads  Music  Pictures	test.txt  Videos  模板
$ cat test.txt                                      //读文件
hello, lcy
$ vim test.txt                              
```
![20191104102030.png](https://i.loli.net/2019/11/04/MhSV87pwsiLzTNu.png)


注：sam的权限并不是只根据ACL配置来决定的，它是由sam用户基本权限与配置的ACL权限的“与”运算决定的，即 *other:rwx & code:r--  = code:r--*

### 3. chacl命令
chacl是用来更改文件或目录的访问控制列表的命令。其和chmod有异曲同工之妙。但是比chmod更为强大，更为精细, 个人理解功能上更趋同于setfacl。

    3.1 chacl命令的格式是: chacl [option] acl filename_or_directory


acl是一个可以被acl_from_text程序分析出各用户权限的字符串。该字符串用逗号分隔成多个片段

每个片段的形式都如：tag:name:perm

tag可以是下面形式的一种：
- *"user" (or "u")*: 表示这是一个用户的ACL条目。
- *"group" (or "g")*: 表示这是一个用户组的ACL条目。
- *"other" (or "o")*: 表示这是其它的ACL条目。即没有在ACL指定的用户和组的ACL条目。
- *"mask" (or "m")*: 表示这是一个掩码的ACL条目。在指定其它非用户属主的ACL权限时，这个掩码条目必须被指定，否则执行chacl命令会出错。
拿上面的例子
![20191104110645.png](https://i.loli.net/2019/11/04/2LsSNrTXIwu4qEb.png)
mask只会对圈起来的内容有影响，对属主和其他用户没有影响。为了在不破坏已有ACL的定义的基础上，可以临时提高或是降低安全级别。
对于[mask的介绍](https://www.jianshu.com/p/0e1572fc1e34)

name可以是用户名或组名。如果不指定，那么默认是给文件或目录的属主或用户组指定acl权限。当然name也可以是用户的uid或者组的gid。

perm是指**该用户或组所具有的权限**，它是由"rwx"组成的一个字符串。如果要使该用户或组不具有某种权限，简单的以"-"代替指定的字母就可以了。例如"r-x"是只具有读，执行权限。

    3.2 例子
test 文件的创建者拥有'rwx'权限，同组的拥有权限'r-x'，其他人只有读权限。
```
root@lcy-PC:/home/lcy# touch test.txt
root@lcy-PC:/home/lcy# ls
Desktop  Documents  Downloads  Music  Pictures	test.txt  Videos  模板
root@lcy-PC:/home/lcy# getfacl --omit-header test.txt
user::rw-
group::r--
other::r--

root@lcy-PC:/home/lcy# chacl u::rwx, g::r-x, o::r-- test.txt    //注意这里的逗号不要跟着空格
chacl: access ACL 'u::rwx,': Missing or wrong entry at entry 1 
root@lcy-PC:/home/lcy# 
root@lcy-PC:/home/lcy# chacl u::rwx,g::r-x,o::r-- test.txt
root@lcy-PC:/home/lcy# 
root@lcy-PC:/home/lcy# getfacl --omit-header test.txt
user::rwx
group::r-x
other::r--

root@lcy-PC:/home/lcy# 
```    
上面的功能用chmod 也可以实现，接下来举一个有说服力的样例：
设置 sam 对文档只有读权限，而不限制其他成员。
```
root@lcy-PC:/home/lcy# chacl u::rwx,g::r-x,o::---,u:sam:r--,m::r-x test.txt
root@lcy-PC:/home/lcy# 
root@lcy-PC:/home/lcy# getfacl --omit-header test.txt
user::rwx
user:sam:r--
group::r-x
mask::r-x
other::---
```

### 4. chmod 和 chown 命令
chmod(change file mode): 更改文件权限。权限的更改者必须是文件的所有者或者是root用户。把权限分为三种：用户，组，其它人。通过chmod你可以指定文件属主的权限，文件所在组的用户的权限，其它人的权限。
```
chmod -R [ugoa][+-=][rwx] 文件……
chmod -R 666
```
对于选项 *-R* ,指的是递归，进行目录操作。大写的选项一般是要求慎重考虑的。

    4.1 chmod 例子：
修改test的权限为，所有者具有权限 'rwx'，同组的可写可读，其他人不可读不可写不可运行
```
lcy@lcy-PC:~$ ls -lh test.txt
-rwxr-x---+ 1 root root 0 11月  4 11:47 test.txt
lcy@lcy-PC:~$ sudo chmod 760 test.txt               //使用特权
[sudo] lcy 的密码：
lcy@lcy-PC:~$ ls -lh test.txt
-rwxrw----+ 1 root root 0 11月  4 11:47 test.txt
lcy@lcy-PC:~$ 
```

chown， 更改文件的所属组。
linux中，共享文件时，不仅需要分享文件，还要分享权限。修改所属组可以将文件权限共享给一组用户。 chgrp 也可以更改文件的所属组。
```
chown -R [所有者][:[新所属组]] 文件……   // 更改文件的所有者或所属组，改变所有者必须具有超级权限
chgrp -R 新所属组 文件……
```

    4.2 chown 例子
chown 更改文件的所有者和组
```
lcy@lcy-PC:~$ ls -lh test.txt
-rwxrw----+ 1 root root 0 11月  4 11:47 test.txt
lcy@lcy-PC:~$ sudo chown lcy:lcy test.txt
lcy@lcy-PC:~$ ls -lh test.txt
-rwxrw----+ 1 lcy lcy 0 11月  4 11:47 test.txt
lcy@lcy-PC:~$ 
```
---
> 对于每节课的回顾整理非常有必要

- 边缘计算和区块链的关系？
- 区块链需要高并发吗？

区块
- hash 函数
- hash 指针


1. hash函数：
抗碰撞，隐匿性，单向性
2. hash指针：
指向存储数据及其数据hash 的指针。验证数据的完整性
3. 梅克尔树 是B树？

The Byzantine Generals Problem /1982
Paxos Made Simple
To build a healthier society, we need to start with our own personal action--make healthy choices, so that we will have the future we dream of.